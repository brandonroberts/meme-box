<div>
  <form [formGroup]="mainAccountForm">


    <mat-form-field>
      <mat-label>Channel-Name</mat-label>
      <input autocomplete="off" [readonly]="!editMode"
             formControlName="name" (keyup.enter)="save()"
             class="twitchSetting__input"
             matInput required>

      <mat-error *ngIf="mainAccountForm.controls['name'].hasError('required')">
        Please enter your Twitch channel name
      </mat-error>

      <button (click)="toggleOrSave()" matSuffix
              color="primary"
              class="twitchSetting__button"
              mat-raised-button>{{editMode ? 'Update' : 'Edit'}}</button>

    </mat-form-field>

    <div class="explanation">
      If you want to trigger media clips on Twitch-Events, then you need to provide a Channel-Name in order subscribe to
      these events.
    </div>

    <ng-container *ngIf="showAdvancedOptions">
      <ng-container *ngIf="config$ | async as config">
        <br />
        <mat-checkbox [checked]="config?.twitch?.enableLog" (change)="onCheckboxChanged($event, config)">Enable Twitch LOG
        </mat-checkbox>
        <br />
        <br />

        <br />
      </ng-container>
    </ng-container>
  </form>
</div>

<div *ngIf="config$ | async as config">
  <form [formGroup]="botAccountForm" *ngIf="config?.twitch?.bot">
    <mat-checkbox [checked]="config?.twitch?.bot?.enabled"
                  (change)="onBotIntegrationChanged($event, config)">Enable Bot Integration
    </mat-checkbox>

    <mat-tab-group>
      <mat-tab label="Authentication">

        <p>To obtain the bot token, login into twitch with your bot account, click on the "Get Twitch Token" button and
          follow the steps in the window that opens.<br /></p>
        <p><br /><a mat-button mat-raised-button href="https://twitchapps.com/tmi/" target="_blank"
                    class="twitchSetting__token-button">
          <mat-icon svgIcon="launch"></mat-icon> &nbsp;Get Twitch Token</a></p>

        <mat-form-field>
          <mat-label>Bot name</mat-label>
          <input autocomplete="off" [readonly]="!config?.twitch?.bot.enabled"
                 formControlName="botName"
                 class="twitchSetting__input"
                 matInput required>

          <mat-error *ngIf="botAccountForm.controls['botName'].hasError('required')">
            Please enter bot name
          </mat-error>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Bot token</mat-label>
          <input autocomplete="off" [readonly]="!config?.twitch?.bot.enabled"
                 formControlName="botToken"
                 class="twitchSetting__input" type="password"
                 matInput required>

          <mat-error *ngIf="botAccountForm.controls['botToken'].hasError('required')">
            Please enter bot oAuth token
          </mat-error>
        </mat-form-field>
      </mat-tab>
      <mat-tab label="Bot settings">
        <mat-form-field>
          <mat-label>Bot response</mat-label>
          <textarea autocomplete="off" [readonly]="!config?.twitch?.bot.enabled"
                    formControlName="botResponse"
                    class="twitchSetting__textarea"
                    matInput></textarea>

          <mat-error *ngIf="botAccountForm.controls['botResponse'].hasError('required')">
            Please enter bot response message.
          </mat-error>
        </mat-form-field>

        <p>
          The message that will be outputted the the chat when someone writes !commands. Use
          <code>{{commandsFlagMessage}}</code>
          to print out the whole list of twitch commands available in memebox and
          <code>{{userFlagMessage}}</code>
          to reference the user that asked for commands.
        </p>
      </mat-tab>
    </mat-tab-group>

    <button (click)="saveBotData()" matSuffix
            color="primary"
            class="twitchSetting__button"
            [disabled]="!config?.twitch?.bot.enabled"
            mat-raised-button>Save
    </button>
  </form>
</div>

